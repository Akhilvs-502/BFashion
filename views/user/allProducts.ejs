<%- include('../partials/header') %>







  <!-- Breadcrumb -->
  <div class="flex ml-2">

    <ul class="flex items-center justify-center font-[sans-serif] space-x-4 mt-4">
      <a href="/user/home">
        <li class="text-gray-500 text-base cursor-pointer">
          Home
        </li>
      </a>
      <li>
        <svg xmlns="http://www.w3.org/2000/svg" class="fill-gray-400 w-3.5 -rotate-90" viewBox="0 0 24 24">
          <path fill-rule="evenodd"
            d="M11.99997 18.1669a2.38 2.38 0 0 1-1.68266-.69733l-9.52-9.52a2.38 2.38 0 1 1 3.36532-3.36532l7.83734 7.83734 7.83734-7.83734a2.38 2.38 0 1 1 3.36532 3.36532l-9.52 9.52a2.38 2.38 0 0 1-1.68266.69734z"
            clip-rule="evenodd" data-original="#000000"></path>
        </svg>
      </li>
      <a href="/user/allProducts">
        <li class="text-gray-500 text-base cursor-pointer">
          All product
        </li>
      </a>
      <li>
        <svg xmlns="http://www.w3.org/2000/svg" class="fill-gray-400 w-3.5 -rotate-90" viewBox="0 0 24 24">
          <path fill-rule="evenodd"
            d="M11.99997 18.1669a2.38 2.38 0 0 1-1.68266-.69733l-9.52-9.52a2.38 2.38 0 1 1 3.36532-3.36532l7.83734 7.83734 7.83734-7.83734a2.38 2.38 0 1 1 3.36532 3.36532l-9.52 9.52a2.38 2.38 0 0 1-1.68266.69734z"
            clip-rule="evenodd" data-original="#000000"></path>
        </svg>
      </li>

    </ul>

  </div>

  <div class="flex ">

    <!-- Filters -->
    <div class="w-52 mt-12 ml-2 hidden sm:hidden md:block lg:block">
      <div class=" flex justify-between">
        <h1 class="font-bold text-2xl">Filters</h1>
        <% if(filters.length>0){%> <a href="/user/allProducts">
            <div class="text-red-400 mt-1">Clear all </div>
          </a>
          <%} %>
      </div>
      <div class="flex flex-wrap ">
        <% filters.forEach(filter=>{%>

          <div class="ml-1 rounded-full border-2 w-20 text-center ">
            <%=filter%>
          </div>
          <%}) %>
      </div>
      <div id="categoryFilter">
        <h1 class="font-bold mt-6 ">Categories</h1>
        <input class="mt-4" value="men" type="checkbox" <% if(filters.includes("mens")){%> checked<% }%> >
          <label for="">Men</label> <br>
          <input class="mt-4" value="women" type="checkbox" <% if(filters.includes("womens")){%> checked<% }%> >
            <label for="">Women</label><br>
            <input class="mt-4" value="kids" type="checkbox" <% if(filters.includes("kids")){%> checked<% }%> >
              <label for="">Kids</label>
      </div>
      <div class="mt-4">
        <h1 class="font-bold">Price</h1>
        <select id="selectPrice" class=" w-full p-2 border rounded-md  focus:ring-2 ">
          <option class="  " value="">select</option>

          <option class="price" value="high-low" <% if(filters.includes("high-low")){%> selected <% }%>>High-Low
          </option>
          <option class="price  " value="low-high" <% if(filters.includes("low-high")){%> selected <% }%>>Low-High
          </option>
        </select>
      </div>
      
      <div class="mt-4">
        <h1 class="font-bold">Product Name</h1>
        <select id="sortProduct" class=" w-full p-2 border rounded-md  focus:ring-2 ">
          <option class="  " value="">select</option>
          <option class="  " value="aA-zZ" <% if(filters.includes("aA-zZ")){%> selected <% }%>>aA-zZ</option>
          <option class="  " value="zZ-aA" <% if(filters.includes("zZ-aA")){%> selected <% }%>>zZ-aA</option>
        </select>
      </div>
      
      <div id="lastFilter">
        <h1>_____________________________</h1>
        <input class="mt-4" value="newArrivals" type="checkbox" <% if(filters.includes("newArrivals")){%> checked<% }%>
          >
          <label for="">New Arrivals</label> <br>
          <input class="mt-4" value="stock" type="checkbox" <% if(filters.includes("stock")){%> checked<% }%> >
            <label for="">Include outof stock</label> <br>

      </div>

    </div>

    <div>
      <section>
        <div class="font-sans p-4 mx-auto lg:max-w-5xl md:max-w-3xl sm:max-w-full">

          <h2 class="text-lg  lg:text-2xl font-extrabold text-gray-800 mb-12">All products</h2>

          <div class="grid grid-cols-2  sm:grid-cols-2 lg:grid-cols-3 gap-6">
            <% products.forEach(product=>{%>
              <!-- <a href="/user/productView/<%=product._id %>"> -->
              <div id="product"
                class="bg-white rounded overflow-hidden shadow-md cursor-pointer hover:scale-[1.02] transition-all">
                <div class="w-full aspect-w-4 aspect-h-3 lg:h-60">
                  <img src="<%=product.images[0] %>" alt="Product 1" class="h-full w-full object-cover object-top" />
                </div>

                <div class="p-4">
                  <h3 class="text-sm lg:text-lg font-bold text-gray-800">
                    <%=product.productName %>
                  </h3>
                  <p class="text-sm lg:text-lg">
                    <%=product.description %>
                  </p>
                  <div class="mt-4 flex items-center flex-wrap gap-2">
                    <h4 class="text-lg font-bold text-gray-800">â‚¹<%=product.price %>
                    </h4>
                    <h4 class="text-lg font-light line-through text-red-500">
                      <%=product.discount %>%
                    </h4>
                    <!-- <a href="/user/addToWishlist" > -->
                    <!-- <div class="float-right"> -->
                      <div id="Wishlist"
                        class="bg-gray-100 p-1 w-10 h-10 flex items-center   rounded-full cursor-pointer">

    

                            <% if (wishlistProduct.some(item=> item.productId.equals(product._id))) { %>
                              <svg  width="300px"   height="500px" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
                                <path fill="#FF0000" d="M480.25 156.355c0 161.24-224.25 324.43-224.25 324.43S31.75 317.595 31.75 156.355c0-91.41 70.63-125.13 107.77-125.13 77.65 0 116.48 65.72 116.48 65.72s38.83-65.73 116.48-65.73c37.14.01 107.77 33.72 107.77 125.14z" />
                              </svg>
                              
                                <% } else { %>
                              
                                  <svg width="300px" height="500px" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path fill="#E0E0E0" 
                                    d="M480.25 156.355c0 161.24-224.25 324.43-224.25 324.43S31.75 317.595 31.75 156.355c0-91.41 70.63-125.13 107.77-125.13 77.65 0 116.48 65.72 116.48 65.72s38.83-65.73 116.48-65.73c37.14.01 107.77 33.72 107.77 125.14z"/></svg>
    
                                    <% } %>

                            
                              <div id="productID" class="hidden">
                                <%=product._id %>
                              </div>
                          </div>
                        <!-- </div> -->
                          <!-- </a> -->

                      </div>
                  </div>
                </div>
                <!-- </a> -->
                <%}) %>




              </div>
          </div>

      </section>

    </div>
  </div>

  <div class="pagination flex items-center justify-center mt-12 space-x-2">
    <% if (currentPage> 1) { %>
      <a href="/user/allProducts?men=<%=filters.includes('mens') ? 'true' :'false'%>&&women=<%=filters.includes('womens') ? 'true':'false'%>&&kids=<%=filters.includes('kids') ? 'true' :'false'%>&&price=<%=filters.includes('high-low') ? 'high-low' : (filters.includes('low-high') ? 'low-high' : 'false')%> &&page=<%= currentPage - 1 %>&limit=<%= limit %>&&stock=<%=filters.includes('stock') ? 'true' :'false'%>&&newArrivals=<%=filters.includes('newArrivals') ? 'true' :'false'%>"
        class="px-4 py-2 text-sm text-gray-700 bg-gray-200 rounded hover:bg-gray-300 transition-colors">
        Previous
      </a>
      <% } %>

        <!-- Loop through the total number of pages -->
        <% for (let i=1; i <=totalPages; i++) { %>
          <% if (i===currentPage) { %>
            <span class="px-4 py-2 text-sm font-bold text-white bg-blue-600 rounded">
              <%= i %>
            </span>
            <% } else { %>
              <a href="/user/allProducts?men=<%=filters.includes('mens') ? 'true' :'false'%>&&women=<%=filters.includes('womens') ? 'true':'false'%>&&kids=<%=filters.includes('kids') ? 'true' :'false'%>&&price=<%=filters.includes('high-low') ? 'high-low' : (filters.includes('low-high') ? 'low-high' : 'false')%>&&page=<%= i %>&limit=<%= limit %>&&stock=<%=filters.includes('stock') ? 'true' :'false'%>&&newArrivals=<%=filters.includes('newArrivals') ? 'true' :'false'%>"
                class="px-4 py-2 text-sm text-gray-700 bg-gray-200 rounded hover:bg-gray-300 transition-colors">
                <%= i %>
              </a>
              <% } %>
                <% } %>

                  <% if (currentPage < totalPages) { %>
                    <a href="/user/allProducts?men=<%=filters.includes('mens') ? 'true' :'false'%>&&women=<%=filters.includes('womens') ? 'true':'false'%>&&kids=<%=filters.includes('kids') ? 'true' :'false'%>&&price=<%=filters.includes('high-low') ? 'high-low' : (filters.includes('low-high') ? 'low-high' : 'false')%>&&page=<%= currentPage + 1 %>&limit=<%= limit %>&&stock=<%=filters.includes('stock') ? 'true' :'false'%>&&newArrivals=<%=filters.includes('newArrivals') ? 'true' :'false'%>"
                      class="px-4 py-2 text-sm text-gray-700 bg-gray-200 rounded hover:bg-gray-300 transition-colors">
                      Next
                    </a>
                    <% } %>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

  <script>

    // const filters=JSON.parse(<%=JSON.stringify(filters[0]) %>)
    // console.log(filters);
    const filters = <%-JSON.stringify(filters) %>
      console.log(filters);

    let men = filters.includes('mens') ? true : false
    let women = filters.includes('womens') ? true : false
    let kids = filters.includes('kids') ? true : false
    let price = filters.includes('low-high') ? 'low-high' : false
    price = filters.includes('high-low') ? 'high-low' : false
    let sort = filters.includes('aA-zZ') ? 'aA-zZ' : false
    sort = filters.includes('zZ-aA') ? 'zZ-aA' : false
    let stock = filters.includes('stock') ? true : false
    let newArrivals = filters.includes('newArrivals') ? true : false


    document.getElementById("categoryFilter").addEventListener('change', (event) => {
      const categoryFilter = document.getElementById("categoryFilter").querySelectorAll("input[type='checkbox']:checked")
      const categoryList = Array.from(categoryFilter).map(filter => filter.value)
      men = categoryList.includes('men') ? true : false
      women = categoryList.includes('women') ? true : false
      kids = categoryList.includes('kids') ? true : false
      window.location.href = `/user/allProducts?men=${men}&&women=${women}&&kids=${kids}&&price=${price}&&sort=${sort}&&stock=${stock}&&newArrivals=${newArrivals}`


    

    })

    document.getElementById("selectPrice").addEventListener("change", (event) => {
      console.log(event.target.value);
      price = event.target.value
      window.location.href = `/user/allProducts?men=${men}&&women=${women}&&kids=${kids}&&price=${price}&&sort=${sort}&&stock=${stock}&&newArrivals=${newArrivals}`
    })
    document.getElementById("sortProduct").addEventListener("change", (event) => {
      console.log(event.target.value);
      sort = event.target.value
      console.log(sort);
      window.location.href = `/user/allProducts?men=${men}&&women=${women}&&kids=${kids}&&price=${price}&&sort=${sort}&&stock=${stock}&&newArrivals=${newArrivals}`
    })
    document.getElementById("search").addEventListener("change", (event) => {
      console.log(event.target.value);
      search = event.target.value
      console.log(search);
      window.location.href = `/user/allProducts?men=${men}&&women=${women}&&kids=${kids}&&price=${price}&&sort=${sort}&&search=${search}`

    })
    document.getElementById("lastFilter").addEventListener('change', (event) => {
      const lastFilter = document.getElementById("lastFilter").querySelectorAll("input[type='checkbox']:checked")
      const categoryList = Array.from(lastFilter).map(filter => filter.value)
      stock = categoryList.includes('stock') ? true : false
      newArrivals = categoryList.includes('newArrivals') ? true : false
      window.location.href = `/user/allProducts?men=${men}&&women=${women}&&kids=${kids}&&price=${price}&&sort=${sort}&&stock=${stock}&&newArrivals=${newArrivals}`
    })


    document.querySelectorAll("#product").forEach(results => results.addEventListener("click", () => {
      const productID = results.querySelector("#productID").innerHTML.trim()
      window.location.href = `/user/productView/${productID}`
      console.log("outer");
      console.log(productID);


    }))

    document.querySelectorAll("#Wishlist").forEach(results => results.addEventListener("click", function (event) {
      event.stopPropagation();
      console.log(event.target);

      const productID = results.querySelector("#productID").innerHTML.trim()

      axios.post("/user/addToWhishlist", { productID }).then(response => {
        console.log(response.data);
        event.target.setAttribute("fill","#FF0000")   
        const Toast = Swal.mixin({
          toast: true,
          position: "top-end",
          showConfirmButton: false,
          timer: 3000,
          timerProgressBar: true,
          didOpen: (toast) => {
            toast.onmouseenter = Swal.stopTimer;
            toast.onmouseleave = Swal.resumeTimer;
          }
        });
        Toast.fire({
          icon: "success",
          title: "product added to wishlist"
        });

      })
        .catch(err => {

          const Toast = Swal.mixin({
            toast: true,
            position: "top-end",
            showConfirmButton: false,
            timer: 3000,
            timerProgressBar: true,
            didOpen: (toast) => {
              toast.onmouseenter = Swal.stopTimer;
              toast.onmouseleave = Swal.resumeTimer;
            }
          });
          Toast.fire({
            icon: "info",
            title: "already added wishlist"
          });

        })
    }))



  </script>